{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u684C\\u9762\\\\FYP\\\\\\u672C\\u5730git\\u4ED3\\u5E93\\\\react-sidebar-v1\\\\src\\\\pages\\\\Home.js\";\nimport React, { useState, useEffect } from 'react';\nimport Editor from '../components/Editor';\nimport useLocalStorage from './hooks/useLocalStorage';\nconst [html, setHtml] = useLocalStorage('html', '');\n// const [css, setCss] = useLocalStorage('css', '')\n// const [js, setJs] = useLocalStorage('js', '')\nconst [srcDoc, setSrcDoc] = useState('');\nconst Conversion = \"\\\\\";\nuseEffect(() => {\n  // function getHTMLFromServer(){\n  //   const doc = fetch('http://127.0.0.1:5000/getHTML')\n  //    .then(function(response) {\n  //       return response.text()\n  //   })\n  //   .catch(function(err) {\n  //   console.log(err);\n  //    })\n  //    .then(\n  //     res => {\n  //       setHtml(res)\n  //     }\n  //   );\n  //   console.log(doc)\n  //   return doc\n  // }\n  // getHTMLFromServer()\n\n  const timeout = setTimeout(() => {\n    setSrcDoc(`\n      ${html}\n      <style>\n      *{\n        -moz-user-select:none;/*火狐*/\n        -webkit-user-select:none;/*webkit浏览器*/\n        -ms-user-select:none;/*IE10*/\n        -khtml-user-select:none;/*早期浏览器*/\n          user-select:none;\n    }\n      .selected{\n        position:relative;\n        cursor:pointer;\n        }\n     .selected:after{\n          }\n     .selected:hover:after{\n        position:absolute;\n        left:0;\n        width:100%;\n        height:100%;\n        background-color:red;\n        opacity:.3;\n        pointer-events: none;\n        content:\"\"\n       }\n      </style>\n      <script>\n    \n    \n \n      function countNum(arr,element){\n         let count = 0;\n         for(let i=0;i<arr.length;i++){\n            if(arr[i]==element){\n              count++\n            }\n         }\n         return count\n      }\n\n      function getLine(word,wordNum){\n        let html = localStorage.getItem(\"codepen-clone-html\");\n        let stack =[]\n        let line=1;\n        for(let i=0;i<html.length;i++){\n          //判断首字母相同\n          if(word[0]==html[i]){\n                    \n          //判断字符出现的位置，并限定字符出现在><之间\n          if(html.substr(i,word.length)==word&&html[i-1]==\">\"&&html[i+word.length]==\"<\"){\n              stack.push([i])\n              i=i+word.length\n          }\n         }\n        }\n        let ch = 0;\n        for(let i=0;i<=stack[wordNum];i++){\n          if(html[i]!=\"${Conversion}${Conversion}\"){\n            ch++\n          }\n          if(html.substr(i,2)==\"${Conversion}${Conversion}n\"){\n            line++\n            ch=0;\n         }\n        }\n        return JSON.stringify({\n          line: line-1,\n          ch: ch-2+word.length\n        })\n      }\n      \n      window.addEventListener('scroll', function() {\n        localStorage.setItem(\"scrollTop\", document.documentElement.scrollTop)\n      })\n\n      window.onload=function(){\n        let stack=[];\n        let allEvent = document.getElementsByTagName(\"*\");\n        let editor = window.parent.document.querySelector('.CodeMirror').CodeMirror; \n        document.documentElement.scrollTop = localStorage.getItem(\"scrollTop\")\n\n        //防止editor失去焦点\n        document.onmousedown=function(e){\n          event.preventDefault();\n        }\n\n        for(let i=0;i<allEvent.length;i++){\n          //选择内容非空且没有孩子元素的节点\n          if(allEvent[i].children.length==0 && allEvent[i].innerHTML!=\"\"){\n              stack.push(allEvent[i].innerHTML);\n              allEvent[i].classList.add('selected');\n              allEvent[i].setAttribute(\"selectedId\",countNum(stack,allEvent[i].innerHTML)-1);   \n              allEvent[i].onclick=function(e){\n                \n                //防止失去焦点\n                e.preventDefault();\n\n                //阻止冒泡\n                e.stopPropagation();\n                localStorage.setItem(\"location\",getLine(this.innerHTML,parseInt(this.getAttribute(\"selectedId\"))));    \n                console.log(localStorage.getItem(\"location\"))\n                editor.setCursor(JSON.parse(localStorage.getItem(\"location\")));\n            }                \n          }          \n        \n         }                       \n        }\n        </script>\n    `);\n  }, 250);\n  return () => {\n    clearTimeout(timeout);\n    // clearInterval(timer)\n  };\n}, [html]);\nfunction Home() {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"onlineEditor\",\n    className: \"pane top-pane\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Editor, {\n    language: \"xml\",\n    displayName: \"HTML\",\n    value: html,\n    onChange: setHtml,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 5\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pane\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"iframe\", {\n    id: \"iframe\",\n    srcDoc: srcDoc,\n    title: \"output\",\n    sandbox: \"allow-scripts allow-same-origin\",\n    frameBorder: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 5\n    }\n  })));\n}\nexport default Home;","map":{"version":3,"names":["React","useState","useEffect","Editor","useLocalStorage","html","setHtml","srcDoc","setSrcDoc","Conversion","timeout","setTimeout","clearTimeout","Home"],"sources":["D:/桌面/FYP/本地git仓库/react-sidebar-v1/src/pages/Home.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Editor from '../components/Editor'\r\nimport useLocalStorage from './hooks/useLocalStorage'\r\n\r\nconst [html, setHtml] = useLocalStorage('html', '')\r\n// const [css, setCss] = useLocalStorage('css', '')\r\n// const [js, setJs] = useLocalStorage('js', '')\r\nconst [srcDoc, setSrcDoc] = useState('')\r\nconst Conversion = \"\\\\\";\r\n\r\n\r\nuseEffect(() => {\r\n  // function getHTMLFromServer(){\r\n  //   const doc = fetch('http://127.0.0.1:5000/getHTML')\r\n  //    .then(function(response) {\r\n  //       return response.text()\r\n  //   })\r\n  //   .catch(function(err) {\r\n  //   console.log(err);\r\n  //    })\r\n  //    .then(\r\n  //     res => {\r\n  //       setHtml(res)\r\n  //     }\r\n  //   );\r\n  //   console.log(doc)\r\n  //   return doc\r\n  // }\r\n  // getHTMLFromServer()\r\n\r\n  const timeout = setTimeout(() => {\r\n    \r\n    setSrcDoc(`\r\n      ${html}\r\n      <style>\r\n      *{\r\n        -moz-user-select:none;/*火狐*/\r\n        -webkit-user-select:none;/*webkit浏览器*/\r\n        -ms-user-select:none;/*IE10*/\r\n        -khtml-user-select:none;/*早期浏览器*/\r\n          user-select:none;\r\n    }\r\n      .selected{\r\n        position:relative;\r\n        cursor:pointer;\r\n        }\r\n     .selected:after{\r\n          }\r\n     .selected:hover:after{\r\n        position:absolute;\r\n        left:0;\r\n        width:100%;\r\n        height:100%;\r\n        background-color:red;\r\n        opacity:.3;\r\n        pointer-events: none;\r\n        content:\"\"\r\n       }\r\n      </style>\r\n      <script>\r\n    \r\n    \r\n \r\n      function countNum(arr,element){\r\n         let count = 0;\r\n         for(let i=0;i<arr.length;i++){\r\n            if(arr[i]==element){\r\n              count++\r\n            }\r\n         }\r\n         return count\r\n      }\r\n\r\n      function getLine(word,wordNum){\r\n        let html = localStorage.getItem(\"codepen-clone-html\");\r\n        let stack =[]\r\n        let line=1;\r\n        for(let i=0;i<html.length;i++){\r\n          //判断首字母相同\r\n          if(word[0]==html[i]){\r\n                    \r\n          //判断字符出现的位置，并限定字符出现在><之间\r\n          if(html.substr(i,word.length)==word&&html[i-1]==\">\"&&html[i+word.length]==\"<\"){\r\n              stack.push([i])\r\n              i=i+word.length\r\n          }\r\n         }\r\n        }\r\n        let ch = 0;\r\n        for(let i=0;i<=stack[wordNum];i++){\r\n          if(html[i]!=\"${Conversion}${Conversion}\"){\r\n            ch++\r\n          }\r\n          if(html.substr(i,2)==\"${Conversion}${Conversion}n\"){\r\n            line++\r\n            ch=0;\r\n         }\r\n        }\r\n        return JSON.stringify({\r\n          line: line-1,\r\n          ch: ch-2+word.length\r\n        })\r\n      }\r\n      \r\n      window.addEventListener('scroll', function() {\r\n        localStorage.setItem(\"scrollTop\", document.documentElement.scrollTop)\r\n      })\r\n\r\n      window.onload=function(){\r\n        let stack=[];\r\n        let allEvent = document.getElementsByTagName(\"*\");\r\n        let editor = window.parent.document.querySelector('.CodeMirror').CodeMirror; \r\n        document.documentElement.scrollTop = localStorage.getItem(\"scrollTop\")\r\n\r\n        //防止editor失去焦点\r\n        document.onmousedown=function(e){\r\n          event.preventDefault();\r\n        }\r\n\r\n        for(let i=0;i<allEvent.length;i++){\r\n          //选择内容非空且没有孩子元素的节点\r\n          if(allEvent[i].children.length==0 && allEvent[i].innerHTML!=\"\"){\r\n              stack.push(allEvent[i].innerHTML);\r\n              allEvent[i].classList.add('selected');\r\n              allEvent[i].setAttribute(\"selectedId\",countNum(stack,allEvent[i].innerHTML)-1);   \r\n              allEvent[i].onclick=function(e){\r\n                \r\n                //防止失去焦点\r\n                e.preventDefault();\r\n\r\n                //阻止冒泡\r\n                e.stopPropagation();\r\n                localStorage.setItem(\"location\",getLine(this.innerHTML,parseInt(this.getAttribute(\"selectedId\"))));    \r\n                console.log(localStorage.getItem(\"location\"))\r\n                editor.setCursor(JSON.parse(localStorage.getItem(\"location\")));\r\n            }                \r\n          }          \r\n        \r\n         }                       \r\n        }\r\n        </script>\r\n    `)\r\n\r\n  }, 250) \r\n  \r\n  return () => {\r\n    clearTimeout(timeout)\r\n    // clearInterval(timer)\r\n  }\r\n}, [html])\r\n\r\nfunction Home() {\r\n  return (\r\n   <>\r\n    <div id=\"onlineEditor\" className=\"pane top-pane\">\r\n    <Editor\r\n      language=\"xml\"\r\n      displayName=\"HTML\"\r\n      value={html}  \r\n      onChange={setHtml}\r\n    />\r\n  </div>\r\n  \r\n  <div className=\"pane\">\r\n    <iframe\r\n      id=\"iframe\"\r\n      srcDoc={srcDoc}\r\n      title=\"output\"\r\n      sandbox=\"allow-scripts allow-same-origin\"\r\n      frameBorder=\"0\"\r\n      width=\"100%\"\r\n      height=\"100%\"\r\n    />\r\n  </div>\r\n  </>\r\n  );\r\n}\r\n\r\nexport default Home;\r\n"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,OAAOC,MAAM,MAAM,sBAAsB;AACzC,OAAOC,eAAe,MAAM,yBAAyB;AAErD,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGF,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC;AACnD;AACA;AACA,MAAM,CAACG,MAAM,EAAEC,SAAS,CAAC,GAAGP,QAAQ,CAAC,EAAE,CAAC;AACxC,MAAMQ,UAAU,GAAG,IAAI;AAGvBP,SAAS,CAAC,MAAM;EACd;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,MAAMQ,OAAO,GAAGC,UAAU,CAAC,MAAM;IAE/BH,SAAS,CAAE;AACf,QAAQH,IAAK;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyBI,UAAW,GAAEA,UAAW;AACjD;AACA;AACA,kCAAkCA,UAAW,GAAEA,UAAW;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,CAAC;EAEJ,CAAC,EAAE,GAAG,CAAC;EAEP,OAAO,MAAM;IACXG,YAAY,CAACF,OAAO,CAAC;IACrB;EACF,CAAC;AACH,CAAC,EAAE,CAACL,IAAI,CAAC,CAAC;AAEV,SAASQ,IAAI,GAAG;EACd,oBACC,uDACC;IAAK,EAAE,EAAC,cAAc;IAAC,SAAS,EAAC,eAAe;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBAChD,oBAAC,MAAM;IACL,QAAQ,EAAC,KAAK;IACd,WAAW,EAAC,MAAM;IAClB,KAAK,EAAER,IAAK;IACZ,QAAQ,EAAEC,OAAQ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EAClB,CACE,eAEN;IAAK,SAAS,EAAC,MAAM;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACnB;IACE,EAAE,EAAC,QAAQ;IACX,MAAM,EAAEC,MAAO;IACf,KAAK,EAAC,QAAQ;IACd,OAAO,EAAC,iCAAiC;IACzC,WAAW,EAAC,GAAG;IACf,KAAK,EAAC,MAAM;IACZ,MAAM,EAAC,MAAM;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EACb,CACE,CACH;AAEL;AAEA,eAAeM,IAAI"},"metadata":{},"sourceType":"module"}